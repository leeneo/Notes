/*SQL 命令大全*/
--代表注释

/*计算字符串字节长度*/
select LEN('00000002201803291912093015984')
select LEN('汉字') //=2 ，汉字一般占两个字节。

insert into MemberInfo (RegisterTime) values(GETDATE()) --GETDATE()== 当前时间，精确到毫秒

/*分离附加*/

--分离数据库 

use master
sp_detach_db 'database_name'   

--附加数据库

--1,
use master
EXEC sp_attach_db @dbname = N'pubs', 
@filename1 = N'c:\Program Files\Microsoft SQL Server\MSSQL\Data\pubs.mdf', 
@filename2 = N'c:\Program Files\Microsoft SQL Server\MSSQL\Data\pubs_log.ldf' 
此功能将在未来版本的Microsoft SQL Server中删除。避免在新的开发工作中使用此功能，并计划修改当前使用此功能的应用程序。我们建议您使用CREATE DATABASE database_name FOR ATTACH来代替

--2,
use master
CREATE DATABASE newhotel_xyjd
ON PRIMARY (FILENAME = 'D:\data\newhotel_xyjd.mdf') 
FOR ATTACH 
GO


/*db命令*/
sp_helpdb 
sp_helpdb master
use master
create database TestDB
sp_renamedb 'TestDB','MyLocalDb'
sp_helpdb MyLocalDb


/*table命令*/
use MyLocalDb
sp_help	/*查询当前数据库中对象(表，视图等)*/

create table People(
	FirstName nvarchar(6),
	LastName nvarchar(4),
	Age int,
	ID int identity (1,1),
	Primary key (ID)
);

sp_help people;				--查询指定表结构

drop table People

truncate table tbname		--删除表内容，释放表空间，不删除表结构（定义）

delete from tbname			--清空表内容，保留表结构，同truncate

/*增加字段*/
alter table card_type add IsShowInWeChat varchar(1) NOT NULL DEFAULT ('Y')
/*修改字段长度*/
alter table wxStoreOrders alter column paytype varchar(36)
/*删除字段*/
alter table wxStoreOrders drop column paytype varchar(36)

/*视图*/

CREATE VIEW [dbo].[v_wx_NewOrders]
AS
select * from someTable1
union select * from someTable2

/*结果集命令*/

insert into People (LastName,FirstName,Age) values(N'张',N'三','29');
insert into People (LastName,FirstName,Age) values(N'李',N'飞','29');
insert into People (LastName,FirstName,Age) values('张1','三2','29');		--不管是varchar还是nvarchar结构表，这样插入中文 显示乱码
--N'张'与'张' 字节长度是一样的

select distinct FirstName from People

select * from people where id between 2 and 5;		--返回结果集中id<=5&>=2的记录

delete from MemberInfo where MemberName is null		--删除为空数据 is null


/*存储过程*/

--声明变量并赋值
declare @Bdate varchar(20),@Edate varchar(20)
set 
@Bdate='2017-10-01'
set 
@Edate='2018-02-16'

SELECT * from table where SYS_DATE >= @Bdate AND SYS_DATE <= @Edate group by REGCARD.S_CARD_TYPE,s_describe ORDER BY REGCARD.S_CARD_TYPE ASC


--创建链接服务器，远程执行数据库的存储过程
exec sp_addlinkedserver 'TestServer','','SQLOLEDB','120.76.41.xx'
exec sp_addlinkedsrvlogin 'TestServer','false',null,'sa','pwd'
exec sp_serveroption 'TestServer','rpc out','true' --这个允许调用链接服务器上的存储过程

--查询已有链接服务器
 select * from sys.servers

--调用远程服务器存储过程：
exec TestServer.数据库名.dbo.过程名 '参数'

--demo:
select * from TestServer.TestDB.dbo.regcard where s_print_no = '17376852911'
select * from [120.76.42.118]].TestDB.dbo.regcard where s_print_no = '17376852911'

declare @as_error varchar(200)
exec TestServer.TestDB.dbo.Usp_Insert_cardaccount3 '', '11', '消费', @as_error output
select @as_error
